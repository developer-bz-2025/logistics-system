<div class="p-6 max-w-5xl mx-auto">
    <h1 class="text-2xl font-bold text-gray-900">User Roles & Resource Visibility</h1>
    <p class="text-gray-600 mt-1">Understand what each role can see at a glance.</p>

    <!-- Your access (if we can detect a role) -->
    <div *ngIf="currentSummary() as me" class="mt-4 rounded-xl border border-blue-200 bg-blue-50 p-16">
        <div class="text-sm text-blue-900">
            <span class="font-semibold">Your role:</span> {{ me.roleLabel }}.
            <span class="ml-2">You can access:</span>
        </div>
        <div class="mt-2 flex flex-wrap gap-8">
            <span *ngFor="let it of me.items" class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded border"
                [ngClass]="visColor(it.key)">
                <span class="font-medium">{{ it.label }}</span>
                <span *ngIf="it.scope" class="opacity-80">Â· {{ it.scope }}</span>
            </span>
        </div>
    </div>

    <!-- Legend -->
    <div class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-2">
        <div *ngFor="let v of visLegend" class="flex items-center gap-2 text-sm">
            <span class="inline-flex items-center px-2 py-0.5 rounded border" [ngClass]="visColor(v.key)">
                {{ v.label }}
            </span>
            <span class="text-gray-500">{{ v.desc }}</span>
        </div>
    </div>

    <!-- Matrix -->
    <div class="mt-6 overflow-auto rounded-xl border">
        <table class="min-w-[720px] w-full text-sm">
            <thead class="bg-gray-50 text-gray-600">
                <tr>
                    <th class="text-left font-semibold p-3 w-56">Role</th>
                    <th class="text-left font-semibold p-3">Internal</th>
                    <th class="text-left font-semibold p-3">Public</th>
                    <th class="text-left font-semibold p-3">Global</th>
                    <th class="text-left font-semibold p-3">Confidential</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                <tr *ngFor="let role of rolesOrder" [class]="isCurrentRole(role) ? 'bg-blue-50/40' : ''">
                    <td class="p-3 align-top">
                        <div class="font-medium text-gray-900">{{ roleLabel[role] }}</div>
                        <div class="text-xs text-gray-500">
                            <!-- Short descriptor per role -->
                            <ng-container [ngSwitch]="role">
                                <span *ngSwitchCase="'super_admin'">Full access (except confidential).</span>
                                <span *ngSwitchCase="'c_level'">Org-wide non-confidential content.</span>
                                <span *ngSwitchCase="'country_dir'">Own country/entity (internal/public) + all
                                    global.</span>
                                <span *ngSwitchCase="'head_of_entity'">Own entity (internal/public) + all global.</span>
                                <span *ngSwitchCase="'unit_admin'">Own unit (internal) + own entity public + all
                                    global.</span>
                                <span *ngSwitchCase="'standard'">Own unit internal + own entity public + all
                                    global.</span>
                            </ng-container>
                        </div>
                    </td>

                    <!-- For each visibility column -->
                    <td class="p-3">
                        <ng-container *ngIf="matrix[role]['internal'] as c">
                            <div class="flex items-center gap-2">
                                <mat-icon class="text-base" [ngClass]="cellIconClass(c)">{{ cellIcon(c) }}</mat-icon>
                                <div>
                                    <div class="font-medium" [class.text-gray-700]="c.allowed"
                                        [class.text-gray-400]="!c.allowed">
                                        {{ c.allowed ? 'Visible' : 'Not visible' }}
                                    </div>
                                    <div class="text-xs text-gray-500" *ngIf="c.allowed && c.scope">{{ c.scope }}</div>
                                </div>
                            </div>
                        </ng-container>
                    </td>

                    <td class="p-3">
                        <ng-container *ngIf="matrix[role]['public'] as c">
                            <div class="flex items-center gap-2">
                                <mat-icon class="text-base" [ngClass]="cellIconClass(c)">{{ cellIcon(c) }}</mat-icon>
                                <div>
                                    <div class="font-medium" [class.text-gray-700]="c.allowed"
                                        [class.text-gray-400]="!c.allowed">
                                        {{ c.allowed ? 'Visible' : 'Not visible' }}
                                    </div>
                                    <div class="text-xs text-gray-500" *ngIf="c.allowed && c.scope">{{ c.scope }}</div>
                                </div>
                            </div>
                        </ng-container>
                    </td>

                    <td class="p-3">
                        <ng-container *ngIf="matrix[role]['global'] as c">
                            <div class="flex items-center gap-2">
                                <mat-icon class="text-base" [ngClass]="cellIconClass(c)">{{ cellIcon(c) }}</mat-icon>
                                <div>
                                    <div class="font-medium" [class.text-gray-700]="c.allowed"
                                        [class.text-gray-400]="!c.allowed">
                                        {{ c.allowed ? 'Visible' : 'Not visible' }}
                                    </div>
                                    <div class="text-xs text-gray-500" *ngIf="c.allowed && c.scope">{{ c.scope }}</div>
                                </div>
                            </div>
                        </ng-container>
                    </td>

                    <td class="p-3">
                        <ng-container *ngIf="matrix[role]['confidential'] as c">
                            <div class="flex items-center gap-2">
                                <mat-icon class="text-base" [ngClass]="cellIconClass(c)">{{ cellIcon(c) }}</mat-icon>
                                <div>
                                    <div class="font-medium" [class.text-gray-700]="c.allowed"
                                        [class.text-gray-400]="!c.allowed">
                                        {{ c.allowed ? 'Visible' : 'Not visible' }}
                                    </div>
                                    <div class="text-xs text-gray-500" *ngIf="c.allowed && c.scope">{{ c.scope }}</div>
                                </div>
                            </div>
                        </ng-container>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Optional: role cards summary -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div *ngFor="let role of rolesOrder" class="rounded-2xl border p-16" [class.ring-2]="isCurrentRole(role)"
            [class.ring-blue-400]="isCurrentRole(role)">
            <div class="font-semibold">{{ roleLabel[role] }}</div>
            <ul class="mt-2 text-sm text-gray-600 list-disc pl-5">
                <li *ngIf="matrix[role]['internal'].allowed">
                    Internal: {{ matrix[role]['internal'].scope }}
                </li>
                <li *ngIf="matrix[role]['public'].allowed">
                    Public: {{ matrix[role]['public'].scope }}
                </li>
                <li *ngIf="matrix[role]['global'].allowed">
                    Global: {{ matrix[role]['global'].scope }}
                </li>
                <li *ngIf="!matrix[role]['confidential'].allowed" class="text-gray-500">
                    Confidential: not visible in browse
                </li>
            </ul>
        </div>
    </div>
</div>