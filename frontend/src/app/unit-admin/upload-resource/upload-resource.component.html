<!-- upload-resources.component.html -->
<div class="max-w-4xl mx-auto p-8 mb-20" [formGroup]="form">
  <!-- header omitted for brevity -->

  <div class="bg-white rounded-xl shadow p-8 mt-8">
    <h2 class="text-lg font-semibold mb-4 border-b pb-4">Create Resource</h2>

    <div>
      <label class="block font-medium text-gray-700 mb-1">Resource Name</label>
      <input formControlName="res_title" type="text" placeholder="Enter resource name"
             class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
    </div>

    <div>
      <label class="block font-medium text-gray-700 mb-1 mt-6">Description</label>
      <textarea formControlName="res_description" rows="3" placeholder="Brief description"
                class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
    </div>

    <section class="block mt-8">
      <h3>Resource Type</h3>
      <div class="card-grid">
        <button type="button" class="option-card" [ngClass]="[t.bg,t.color]"
                *ngFor="let t of typeCards"
                [class.active]="selectedTypeId() === t.id"
                (click)="pickType(t)"
                [attr.aria-pressed]="selectedTypeId() === t.id">
          <div class="icon-wrapper" [ngClass]="[  t.color]">
            <i-tabler [name]="t.icon" class="icon"></i-tabler>
          </div>
          <div class="title">{{ t.label }}</div>
          <div class="desc">{{ t.desc }}</div>
        </button>
      </div>
    </section>

    <!-- Visibility Settings -->
    <section class="block mt-8">
      <h3>Visibility Settings</h3>
      <div class="card-grid">
        <button type="button" class="option-card"  [ngClass]="[v.bg,v.color]"
                *ngFor="let v of visCards"
                [class.active]="selectedVisId() === v.id"
                (click)="pickVisibility(v)"
                [attr.aria-pressed]="selectedVisId() === v.id">
          <div class="icon-wrapper" [ngClass]="[v.color]">
            <i-tabler [name]="v.icon" class="icon"></i-tabler>
          </div>
          <div class="title">{{ v.label }}</div>
          <div class="desc">{{ v.desc }}</div>
        </button>
      </div>
    </section>
    <!-- RESOURCE CONTENT -->
<section class="block mt-8">
  <h3>Resource Content</h3>

  <!-- URL for System/Useful Link -->
  <mat-form-field *ngIf="showUrl" appearance="outline" class="w-full mb-3">
    <mat-label>System link (type: system | useful link)</mat-label>
    <input matInput formControlName="res_url" placeholder="https://…">
    <mat-error *ngIf="form.get('res_url')?.hasError('required')">URL is required</mat-error>
    <mat-error *ngIf="form.get('res_url')?.hasError('pattern')">Must start with http(s)://</mat-error>
  </mat-form-field>

  <!-- File for Document/Policy -->
  <div *ngIf="showFile" class="file-row border border-gray-300 rounded-lg px-3 py-2 mb-3">
    <button mat-stroked-button type="button" (click)="file.click()">upload</button>
    <span class="file-hint">
      upload file 
      <!-- (type: Document | policy | Reports| Training Materials) -->
    </span>
    <input #file type="file" (change)="onFile($event)" hidden />
  </div>

  <!-- TWO COLUMNS: Tags | Category -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- TAGS -->
    <div>
      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Tags #</mat-label>
        <input
          matInput
          [formControl]="tagInput"
          (keyup.enter)="addTagFromEnter()"
          placeholder="Add tag and press Enter"
        >
      </mat-form-field>

      <!-- chips under input -->
         <!-- Chips -->
      <div class="flex flex-wrap gap-2 mt-2">
        <span *ngFor="let t of selectedTags"
              class="px-2 py-1 rounded-full text-sm bg-green-50 text-green-800 border border-green-200 flex items-center gap-2">
          {{ t }}
          <button type="button" (click)="removeTag(t)" class="hover:opacity-70">&times;</button>
        </span>
      </div>
      
      <!-- <div class="flex flex-wrap gap-2 mt-2">
        <span *ngFor="let t of selectedTags" class="chip-green">
          {{ t }}
          <button type="button" (click)="removeTag(t)" class="chip-x">&times;</button>
        </span>
      </div> -->
    </div>

    <!-- CATEGORY -->
    <div>
      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Category</mat-label>
        <input
          matInput
          [formControl]="categoryCtrl"
          placeholder="e.g., Finance, HR, Payments"
          [matAutocomplete]="catAuto"
        />
        <mat-autocomplete #catAuto="matAutocomplete" (optionSelected)="useCategory($event.option.value)">
          <ng-container *ngIf="(filteredCategories$ | async) as data">
            <mat-option *ngFor="let c of data.list" [value]="c.name">{{ c.name }}</mat-option>
            <mat-option *ngIf="categoryNeedsCreate(data)" [value]="data.q">
              Create “{{ data.q }}”
            </mat-option>
          </ng-container>
        </mat-autocomplete>
      </mat-form-field>
    </div>
  </div>

  <!-- BLUE PREVIEW CARD -->
  <div class="selector-card mt-4">
    <div class="selector-title">Category selector</div>
    <div class="selector-line">
      {{ previewType }} &gt; {{ previewCategory }} &gt; {{ previewTitle }}
      <span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-gray-200 text-gray-800">
        visibility: {{ previewVisibility }}
      </span>
    </div>
    </div>
</section>



<footer class="actions">
  <button mat-stroked-button color="primary"
          routerLink="/unit-admin/resources/my-unit">
    Cancel
  </button>

  <button mat-flat-button color="primary"
          (click)="submit()"
          [disabled]="form.invalid || submitting">
    {{ submitting ? 'Creating…' : 'Create Resource' }}
  </button>
</footer>

<!-- Validation summary -->
<div *ngIf="submitted && form.invalid" class="mt-4 p-3 rounded-lg border border-red-300 bg-red-50 text-red-800" aria-live="polite">
  <div class="font-semibold">Please fix the following:</div>
  <ul class="list-disc pl-5 text-sm">
    <li *ngFor="let m of missingMessages">{{ m }}</li>
  </ul>
</div>

<!-- Success -->
<div *ngIf="createdMsg" class="mt-4 p-3 rounded-lg border border-green-300 bg-green-50 text-green-800" aria-live="polite">
  <div class="font-semibold">Created ✔</div>
  <div class="text-sm">{{ createdMsg.message }}</div>
</div>

<!-- Error -->
<div *ngIf="errorMsg" class="mt-4 p-3 rounded-lg border border-red-300 bg-red-50 text-red-800" aria-live="polite">
  <div class="font-semibold">Failed to create resource</div>
  <div class="text-sm whitespace-pre-wrap">{{ errorMsg }}</div>
</div>



    <!-- <footer class="actions">
      <button mat-stroked-button color="primary" routerLink="/unit-admin/resources/my-unit">Cancel</button>
      <button mat-flat-button color="primary" (click)="submit()">Create Resource</button>
    </footer>

    
    <div *ngIf="created" class="mt-6 p-4 rounded-lg border border-green-300 bg-green-50 text-green-800">
      <div class="font-semibold">Created ✔</div>
      <pre class="text-xs whitespace-pre-wrap">{{ created.message}}</pre>
    </div> -->
  </div>
</div>
