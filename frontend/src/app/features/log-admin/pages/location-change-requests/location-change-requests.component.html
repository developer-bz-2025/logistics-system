<div class="space-y-4">
  <h1 class="text-lg font-semibold">Location Change Requests</h1>

  <!-- Filters -->
  <div class="app-card flex flex-col md:flex-row md:items-end gap-3">
    <div class="flex-1">
      <label class="text-sm font-medium">Quick Search</label>
      <input
        class="w-full rounded-xl border px-3 py-2"
        [(ngModel)]="search"
        (ngModelChange)="onSearchInput($event)"
        (keyup.enter)="onSearchEnter()"
        placeholder="Search by item description, SN, or requester..." />
    </div>

    <div>
      <label class="text-sm font-medium">Status</label>
      <select class="w-48 rounded-xl border px-3 py-2"
              [(ngModel)]="status"
              (ngModelChange)="onFilterChange()">
        <option value="all">All</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Rejected">Rejected</option>
      </select>
    </div>
  </div>

  <!-- Table -->
  <div class="app-card overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="text-left text-gray-500">
        <tr>
          <th class="py-2 pr-4">#</th>
          <th class="py-2 pr-4">Item</th>
          <th class="py-2 pr-4">Current Location</th>
          <th class="py-2 pr-4">Requested Location</th>
          <th class="py-2 pr-4">Requester</th>
          <th class="py-2 pr-4">Request Date</th>
          <th class="py-2 pr-4">Status</th>
          <th class="py-2 pr-4">Notes</th>
          <th class="py-2 pr-4" *ngIf="status === 'Pending' || status === 'all'">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngIf="loading" class="text-gray-500">
          <td class="py-6" [attr.colspan]="status === 'Pending' || status === 'all' ? 9 : 8">Loading…</td>
        </tr>
        <tr *ngIf="!loading && requests.length === 0" class="text-gray-500">
          <td class="py-6" [attr.colspan]="status === 'Pending' || status === 'all' ? 9 : 8">No results.</td>
        </tr>

        <tr *ngFor="let req of requests" class="border-t align-top">
          <td class="py-2 pr-4 font-medium">{{ req.id }}</td>

          <td class="py-2 pr-4">
            <div class="font-medium">
              <a 
                (click)="navigateToAsset(req.item.id)" 
                class="text-indigo-600 hover:text-indigo-800 hover:underline cursor-pointer">
                {{ req.item.fixed_item_name }}
              </a>
            </div>
            <div class="text-xs text-gray-500" *ngIf="req.item.sn">SN: {{ req.item.sn }}</div>
            <div class="text-xs text-gray-500" *ngIf="!req.item.sn">Item ID: {{ req.item.id }}</div>
          </td>

          <td class="py-2 pr-4">
            <span class="font-medium">{{ req.current_location.name }}</span>
          </td>

          <td class="py-2 pr-4">
            <span class="font-medium text-indigo-600">{{ req.requested_location.name }}</span>
          </td>

          <td class="py-2 pr-4">
            <div class="font-medium">{{ req.requested_by.name }}</div>
            <div class="text-xs text-gray-500">{{ req.requested_by.email }}</div>
          </td>

          <td class="py-2 pr-4">
            {{ formatDate(req.request_date) }}
          </td>

          <td class="py-2 pr-4">
            <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs" [ngClass]="statusClass(req.status)">
              {{ req.status }}
            </span>
          </td>

          <td class="py-2 pr-4">
            <span class="text-gray-500" *ngIf="req.notes">{{ req.notes }}</span>
            <span class="text-gray-400" *ngIf="!req.notes">—</span>
          </td>

          <!-- Actions (only for pending requests) -->
          <td class="py-2 pr-4" *ngIf="status === 'Pending' || status === 'all'">
            <div class="flex gap-2" *ngIf="req.status === 'Pending'">
              <button
                class="rounded-xl bg-green-600 text-white px-3 py-1.5 hover:bg-green-700 disabled:opacity-60 text-xs"
                [disabled]="loading"
                (click)="approve(req)">
                Approve
              </button>
              <button
                class="rounded-xl bg-rose-600 text-white px-3 py-1.5 hover:bg-rose-700 disabled:opacity-60 text-xs"
                [disabled]="loading"
                (click)="reject(req)">
                Reject
              </button>
            </div>
            <span class="text-gray-400 text-xs" *ngIf="req.status !== 'Pending'">—</span>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="flex items-center justify-between mt-4 pt-4 border-t">
      <div class="text-xs text-gray-500">
        Showing {{ requests.length }} of {{ total }} requests
      </div>
      <div class="flex gap-2">
        <button
          class="rounded-lg border px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="page === 1"
          (click)="onPageChange(page - 1)">
          Previous
        </button>
        <span class="px-3 py-1 text-sm text-gray-600">
          Page {{ page }} of {{ lastPage }}
        </span>
        <button
          class="rounded-lg border px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="page >= lastPage"
          (click)="onPageChange(page + 1)">
          Next
        </button>
      </div>
    </div>

    <div *ngIf="error" class="mt-3 rounded-xl bg-rose-50 text-rose-700 px-3 py-2">
      {{ error }}
    </div>
  </div>
</div>

