<div class="space-y-4">
    <h1 class="text-xl font-semibold">PR Edit Requests</h1>
  
    <!-- Filters -->
    <div class="app-card flex flex-col md:flex-row md:items-end gap-3">
      <div class="flex-1">
        <label class="text-sm font-medium">Quick Search</label>
        <input
          class="w-full rounded-xl border px-3 py-2"
          [(ngModel)]="search"
          (ngModelChange)="onSearchInput($event)"
          (keyup.enter)="onSearchEnter()"
          placeholder="Search by PR code or requester..." />
      </div>
  
      <div>
        <label class="text-sm font-medium">Status</label>
        <select class="w-48 rounded-xl border px-3 py-2"
                [(ngModel)]="status"
                (ngModelChange)="onFilterChange()">
          <option value="all">All</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>
    </div>
  
    <!-- Table -->
    <div class="app-card overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="text-left text-gray-500">
          <tr>
            <th class="py-2 pr-4">#</th>
            <th class="py-2 pr-4">Requester</th>
            <th class="py-2 pr-4">Requested At</th>
            <th class="py-2 pr-4">Status</th>
            <th class="py-2 pr-4">PR Code</th>
            <th class="py-2 pr-4">Acquisition Date</th>
            <th class="py-2 pr-4">File</th>
            <th class="py-2 pr-4">Total</th>
            <th class="py-2 pr-4"></th>
          </tr>
        </thead>
  
        <tbody>
          <tr *ngIf="loading" class="text-gray-500">
            <td class="py-6" colspan="9">Loading…</td>
          </tr>
          <tr *ngIf="!loading && rows.length === 0" class="text-gray-500">
            <td class="py-6" colspan="9">No results.</td>
          </tr>
  
          <tr *ngFor="let r of rows" class="border-t align-top">
            <td class="py-2 pr-4 font-medium">{{ r.id }}</td>
  
            <td class="py-2 pr-4">
              <div class="font-medium">{{ r.requested_by.name }}</div>
              <div class="text-xs text-gray-500">{{ r.requested_by.email }}</div>
            </td>
  
            <td class="py-2 pr-4">
              {{ r.request_date | date:'medium' }}
            </td>
  
            <td class="py-2 pr-4">
              <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs" [ngClass]="statusClass(r.status)">
                {{ toLcStatus(r.status) | titlecase }}
              </span>
            </td>
  
            <!-- PR Code old -> new -->
            <td class="py-2 pr-4">
              <div *ngIf="r.header_diffs as d">
                <div *ngIf="changed(d.pr_code.old, d.pr_code.new); else sameCode">
                  <span class="line-through text-gray-500">{{ d.pr_code.old }}</span>
                  <span class="mx-1">→</span>
                  <span class="font-medium">{{ d.pr_code.new }}</span>
                </div>
                <ng-template #sameCode>
                  <span>{{ d.pr_code.old }}</span>
                </ng-template>
              </div>
            </td>
  
            <!-- Acquisition Date old -> new -->
            <td class="py-2 pr-4">
              <div *ngIf="r.header_diffs as d">
                <div *ngIf="changed(d.acquisition_date.old, d.acquisition_date.new); else sameDate">
                  <span class="line-through text-gray-500">{{ d.acquisition_date.old | date:'mediumDate' }}</span>
                  <span class="mx-1">→</span>
                  <span class="font-medium">{{ d.acquisition_date.new | date:'mediumDate' }}</span>
                </div>
                <ng-template #sameDate>
                  <span>{{ d.acquisition_date.old | date:'mediumDate' }}</span>
                </ng-template>
              </div>
            </td>
  
            <!-- File link(s) -->
            <td class="py-2 pr-4">
              <div *ngIf="r.header_diffs as d" class="space-y-1">
                <div>
                  <span class="text-gray-500 mr-1">Old:</span>
                  <a *ngIf="d.pr_path.old_url; else noOld" class="text-indigo-600 hover:underline" [href]="d.pr_path.old_url" target="_blank" rel="noopener">Open</a>
                  <ng-template #noOld>—</ng-template>
                </div>
                <div>
                  <span class="text-gray-500 mr-1">New:</span>
                  <a *ngIf="d.pr_path.new_url; else noNew" class="text-indigo-600 hover:underline" [href]="d.pr_path.new_url" target="_blank" rel="noopener">Open</a>
                  <ng-template #noNew>—</ng-template>
                </div>
              </div>
            </td>
  
            <!-- Total old -> new + delta -->
            <td class="py-2 pr-4">
              <div *ngIf="r.header_diffs as d">
                <div *ngIf="changed(d.total_price.old, d.total_price.new); else sameTotal">
                  <span class="line-through text-gray-500">{{ d.total_price.old | number:'1.2-2' }}</span>
                  <span class="mx-1">→</span>
                  <span class="font-medium">{{ d.total_price.new | number:'1.2-2' }}</span>
                  <div class="text-xs" [ngClass]="deltaClass(priceDelta(d))">
                    Δ {{ priceDelta(d) | number:'1.2-2' }}
                  </div>
                </div>
                <ng-template #sameTotal>
                  <span>{{ d.total_price.old | number:'1.2-2' }}</span>
                </ng-template>
              </div>
            </td>
  
            <!-- Actions -->
            <td class="py-2 pr-4">
              <button class="rounded-xl bg-indigo-600 text-white px-3 py-1.5 hover:bg-indigo-700"
                      (click)="onReview(r)">Review</button>
            </td>
          </tr>
        </tbody>
      </table>
  
      <!-- Simple pagination -->
      <div class="flex items-center justify-between mt-3">
        <div class="text-xs text-gray-500">Total: {{ total }}</div>
        <div class="flex gap-2">
          <button class="rounded-lg border px-3 py-1" [disabled]="page===1" (click)="onPageChange(page-1)">Prev</button>
          <button class="rounded-lg border px-3 py-1" (click)="onPageChange(page+1)"
                  [disabled]="rows.length < perPage">Next</button>
        </div>
      </div>
  
      <div *ngIf="error" class="mt-3 rounded-xl bg-rose-50 text-rose-700 px-3 py-2">
        {{ error }}
      </div>
    </div>
  </div>
  